## Introduction

Using pinyin on Linux has been improved a lot, especially with Fcitx (both 4 and 5). But I tried Google Input Tools and personally I feel it gives much better prediction. So I want to bring to Linux. Note, both IBus and Fcitx have cloud pinyin that kind of does this already. But it has a few issues that hinders usability:

1. There's only one candidate from cloud. I can see that cloud pinyin is mostly good at long pinyin so taking just one candidate strikes a good balance between efforts and feature. But having all candidates provides better experience.

2. It seems the HTTP connection of getting that candidate from cloud is re-established every time one types. This creates a lot of latency for cloud piniyin. Cloud pinyin can be fast. In my area (North America), the latency has been consistenly between 70ms-150ms. With async, this is more than acceptable.

## Project Structure

 - fcitx5 - necessary code that makes fcpinyin works on Fcitx 5.
 - fcpinyin - gets candidates from Google Input Tools and does caching.

## How to Build

### Fcitx5

Enter the folder, the build system is CMake. But because the fcitx5 verison of the input method uses Rust code to get the candidates (called by C++ code), to ease the binding work, I used [CXX](cxx.rs). The idea is to first compile the Rust code get a statically linked object file. Then, use the header file generated by CXX so C++ knows how to access functions and variables in the object file.

The whole build step looks like this:

1. Build Rust code.
2. Build C++ code.
3. Install binary to OS to test.

So instead of running CMake directly, using commands in `run.sh` is probably easier. In the project folder:

- `./run.sh gen-lib` to compile the Rust code into a statically linked object file.
- `./run.sh gen-cxx` to generate header files for that object file using CXX. You need a copy of cxxbridge. I built it from source [here](https://github.com/dtolnay/cxx/tree/master/gen/cmd). 
- `./run.sh init` to get the out-of-source build directory created and a bunch of CMake intialization work
- `./run.sh build` to build the C++ code and link with the previously built object files
- `./run.sh install` to install the binary to OS to test
- `./run.sh uninstall` to uninstall the binary from the OS

Note: the installation directory is specific to Arch. If you use something else, the installtion direction might need to be adjusted. I am new to both Rust and C++ so a lot of these setup may be overly complicated. Let me know if there's a better approach.

## Future Plans
    
-   Less web requests: we could do caching, so common pinyin doesn't need to go through the internet. [done]
-   Better privacy: user defines what words (in pinyin) that shouldn't go to the internet.
-   We could also support user-created words, something regular pinyin input methods already do but cloud ones can't.

## Chinese Symbols and Their FcitxKey Mapping
|Symbol|Input (FcitxKey)|
|-|-|
|，|Comma|
|。|Period|
|：|Colon|
|、|Backslash|
|；|Semicolon|
|？|Question|
|！|Exclam|
|“|QuoteDbl|
|”|QuoteDbl|
|‘|Apostrophe|
|’|Apostrophe|
|…|AsciiCircum|
|（|ParenLeft|
|）|ParenRight|
|《|Less|
|》|Hreater|
|－|Minus|
|—|Underscore|
|／|Slash|
|【|BraceketLeft|
|】|BraceketRight|
|｛|BraceLeft|
|｝|BraceRight|
|￥|Dollar|
|×|Asterisk|